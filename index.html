<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/loader.css">
    <link href="/static/css/select2.min.css" rel="stylesheet" />
    <script src="/static/js/select2.min.js"></script>
    <script src="/static/js/navbar.js"></script>
    <script src="/static/js/plotly-latest.min.js"></script>
    
    <title>Feature Filtering</title>

    <style>
        #feature_selector {
            padding: 10px;
            margin-top: 100px;
            border-color: red;
            /* display: none; */
        }
        .sidenav {
            height: 100%;
            width: 300px;
            position: fixed;
            margin: auto;
            z-index: 1;
            top: 0;
            left: 0;
            border-right: 0.6px solid #000000;
            overflow-x: hidden;
            padding-top: 50px;
        }

        .sidenav a {
            padding: 6px 6px 6px 32px;
            text-decoration: none;
            color: #818181;
            display: block;
        }

        .sidenav a:hover {
            color: #333333;
        }

        @media screen and (max-height: 450px) {
            .sidenav {
                padding-top: 15px;
            }

            .sidenav a {
                font-size: 18px;
            }
        }

    </style>
</head>
<body>
    <div id="navigation"></div>
    
    <div class="modal fade" id="loadMe" tabindex="-1" role="dialog" aria-labelledby="loadMeLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="loader"></div>
                    <div clas="loader-txt">
                        <p><b>Please wait, loading... </b><br><br><small>This might take some time</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div style ="margin-top: 100px; ">

        <div class="container  col-md-3 col-lg-3 col-xs-3">
            <div class="sidenav" style="margin-top: 50px;">
                <div class="container col-xs-15">
                    <!--Select backend kernel for execution-->
                    <h5 style="margin-top: 40px;">Select Kernel for execution</h5>
                    <hr style="margin-top:5px;">
                    <form>
                        <div class="form-group">
                            <label class="radio-inline">
                                <input type="radio" name="kernel" value="python" checked>Python</label>
                            <label class="radio-inline">
                                <input type="radio" name="kernel" onclick="selectPySparkKernel()"
                                    value="pyspark">PySpark
                            </label>
                        </div>
                    </form>
                    <!-- File Upload or Select  -->
                    <h5 style="margin-top: 40px;">Upload or Select File</h5>
                    <hr style="margin-top:5px;">
                    <form>
                        <div class="form-group" id="file_upload_select">
                            <label class="radio-inline">
                                <input type="radio" name="file" onclick="render_file_uploader()" value="upload"
                                    checked>Upload a File</label>
                            <label class="radio-inline">
                                <input type="radio" name="file" onclick="render_file_selector()" value="select">Select
                                an
                                Existing File</label>
                        </div>
                    </form>
                    <!-- File Upload -->
                    <div id="file_upload" style="display: block;">
                        <h5 style='margin-top: 40px;'> Upload File </h5>
                        <hr style="margin-top:5px;">
                        <form class="form-inline" style="display: inline;" enctype="multipart/form-data">
                            <div class="form-group">
                                <input type="file" name="file_name" id="file_name"
                                    accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                                    required>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-success" id="upload_btn" type="button" value="Upload" style="margin-left: -65px;"
                                    onclick="read_csv_data()">Upload</button>
                            </div>
                        </form>
                    </div>
                    <!-- File Select -->
                    <div id="file_list" style="display: none;">
                        <h5 style='margin-top: 40px;'> Select a File </h5>
                        <hr style="margin-top:5px;">
                    </div>
                </div>
            </div>
        </div>
        <div class="container col-md-8 col-lg-7">
            <div class="container col-md-10 col-s-10 col-lg-10">
<!--                  row class for containing form and outputs-->
                <div class="row">
                    
                <h3 style="text-align: center;"> Feature Selection </h3>
                <hr>
                <div id="table_container" style="overflow-x:auto;">
                    <table class = "table table-striped table-bordered table-sm" border = 1 id ="df_before_processing_table"></table>
                </div>
                <!-- style is done above for this div -->
                <div  id = "feature_selector" style="display: none;">
<!--                     <div class="col-lg-12 col-sm-12 col-xl-12  text-center">
                        <h2>Select Feature Filtering Method</h2>
                    </div>
                     -->
                    <h4>FEATURE FILTERING OPTIONS</h4>
                    
                    <hr>
<!--                      -->
                    <form>
                        <div class="form-group col-12">
                            <label for="filtering-selector" class="form-label col-12">FEATURE SELECTION METHOD: &nbsp;</label>
                            <select class="form-control filtering-selector" id = "filtering-selector" name="sellist1" style="margin-left: auto;margin-right: auto;">
<!--                                 <option value="" disabled="disabled" selected="selected"></option> -->
                            </select>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label for="target-selector" class="form-label col-12">TARGET: &nbsp;</label>

<!--                             <label for="target-selector" class="form-label">TARGET: &nbsp;</label> -->
                            <select class="form-control target-selector" id = "target-selector" name="sellist2" style="margin-left: auto;margin-right: auto;">
<!--                                 <option value="" disabled="disabled" selected="selected"></option> -->
                            </select>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label for="k_val" class="form-label ">K VALUE: &nbsp;</label>
                            <input class="form-control k_val" type="number" name="k_val" id="k_val" value="Kval" style="width: 200px;">
                        </div>
                        <hr>
                        <div class="form-group">
                            <button class="btn btn-success form-control" id="filtering_btn" type="button" onclick="">Execute</button>
                        </div>
                    </form>
                    <hr>
                    
                </div>
                
                <div id="feature-selection-descriptions" style="display: none;">
                    <!-- For description of the feature selection methods -->
                    <div class="container-fluid">
                        <h4>METHODS INFO</h4>
                        <hr>
                        <div id="details" role="tablist" aria-multiselectable="true">
                      
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="chiSquare">
                                    <h5 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#details" href="#chiSquareDesc" aria-expanded="false" aria-controls="chiSquareDesc">
                                    Chi-Square Test Selection
                                    </a>
                                    </h5>
                                </div>
                                <div id="chiSquareDesc" class="panel-collapse collapse" role="tabpanel" aria-labelledby="chiSquare">
                                    <div class="panel-body">
                                    Executes the Chi-Squared test of Independence between Categorical variables. And based on chi-squared statistics selects the best features.
                                    </div>
                                </div>
                            </div>
                        
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="infoGain">
                                    <h5 class="panel-title">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#details" href="#infoGainDesc" aria-expanded="false" aria-controls="infoGainDesc">
                                    Information Gain Selection
                                    </a>
                                    </h5>
                                </div>
                                <div id="infoGainDesc" class="panel-collapse collapse" role="tabpanel" aria-labelledby="infoGain">
                                    <div class="panel-body">
                                    Computes the mutual information gain with the target.
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="fisher">
                                    <h5 class="panel-title">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#details" href="#fisherDesc" aria-expanded="false" aria-controls="fisherDesc">
                                    Correlation Coefficient Selection
                                    </a>
                                    </h5>
                                </div>
                                <div id="fisherDesc" class="panel-collapse collapse" role="tabpanel" aria-labelledby="fisher">
                                    <div class="panel-body">
                                    Computes pairwise Pearson correlation coefficient of columns in the file. And based on target feature selects the highest correlating features.
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="corrcoeff">
                                    <h5 class="panel-title">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#details" href="#corrcoeffDesc" aria-expanded="false" aria-controls="corrcoeffDesc">
                                    Fisher Score Selection
                                    </a>
                                    </h5>
                                </div>
                                <div id="corrcoeffDesc" class="panel-collapse collapse" role="tabpanel" aria-labelledby="corrcoeff">
                                    <div class="panel-body">
                                    Computes the fisher scores and selects based on higher fisher score.
                                    </div>
                                </div>
                            </div>
                      
                        </div>
                      
                    </div>
                </div>
                <div id = "analysis_list_container" class="no-gutters" style="display: none; height:350px">
                </div>
                <hr>
                <div id = "plot_container" style="display: none; margin-top: 100px;">
                    <h2>PLOT</h2>
                    <div class="spinner-border loader-element">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <div id = "plot_div"></div>
<!--                     <button class="btn btn-success id="plot_image_save" type="button" value="Save" style="margin-left:65px;"onclick="save_plot_to_workspace()">Save Plot </button> -->
                    <button class="btn btn-success btn-lg" id ="plot_image_save" type="button" value="Save" style="margin-left:70px;" onclick="save_plot_to_workspace()"> Save Plot</button>
                </div>
                <hr>
                <div id = "kbest_features_container" style="display: none; height:350px">
                    <h2>K Best Features</h2>
                    
                </div>

                </div> <!-- extra div for the row element-->

            </div>
        </div>
    </div>

</body>


<script>
    function selectPySparkKernel() {
        window.open("/featureSelection_pyspark", '_self');
        return true;
    }
    var filepath = "";
    var res_columns = "";

    var categorical_columns = "";
    var numeric_columns = "";
    var integer_columns = "";

    var target_candidates = "";
    var target_candidates_chisquare = "";
    var target_candidates_infogain = "";
    var target_candidates_fisher = "";
    var target_candidates_correlation ="";

    const renderSelection= ()=>{
        $(".file-selector").select2({
            placeholder: "Select a file",
            allowClear : true
        });
    }
    const renderFeatureSelector = () => {
        $(".filtering-selector").select2({
            placeholder: "Select a Filtering Method",
            allowClear: true
        });
        $(".target-selector").select2({
            placeholder: "Select a Target",
            allowClear: true
        });
    }
    const addLoader = () => {
        $("#loadMe").modal({
            show: true,//Display loader!
            backdrop: "static", //remove ability to close modal with click
            keyboard: false, //remove option to close with keyboard
        });
    }
    const addLoaderPlot = () => {
        $("#loadMe_plot").modal({
            show: true,//Display loader!
            backdrop: "static", //remove ability to close modal with click
            keyboard: false, //remove option to close with keyboard
        });
    }
    const removeLoaderPlot = () => {
        $("#loadMe_plot").modal("hide");
    }
    const removeLoader = () => {
        $("#loadMe").modal("hide");
    }
    function render_file_uploader(){
        var upload_file = document.getElementById('file_upload')
        upload_file.style.display = "block";
        var select_file = document.getElementById('file_list')
        select_file.style.display = "none"; //we need to remove the file selector in order to load file uploader
        //
    }
    function render_file_selector(){
        console.log("HI selector")
        var uploadFile = document.getElementById('file_upload')
        uploadFile.style.display = "none"
        var select_file = document.getElementById('file_list')
        select_file.style.display = "block"

        //so that we can stop regeneration of the same element multiple times on click
        var file_selector = document.getElementById("file-selector")
        if(file_selector) file_selector.remove()
        var btn_selector = document.getElementById("selector_btn")
        if(btn_selector) btn_selector.remove();

        var requestOptions = {
            method:"GET",
            redirect:"follow"
        }
        fetch("/api/v1/ListOfFiles" , requestOptions)
        .then(response => response.text())
        .then(result=>{
            res = JSON.parse(result)
            
            console.log("listofiles_res" , res)
            var _div  = document.getElementById('file_list')
            var sel = document.createElement('select'); //select type of element
            sel.setAttribute("class" , "file-selector")
            sel.setAttribute("id" , "file-selector")
            sel.setAttribute("style" , "width:200px;")
            // sel.setAttribute("placeholder" ,"Please select a file")
            var opt = document.createElement("option")
            opt.setAttribute("value","")
            opt.setAttribute("disabled","disabled")
            opt.setAttribute("selected","selected")
            opt.innerHTML = "Please select a file"
            sel.appendChild(opt)
            _div.appendChild(sel)

            for(var i = 0 ; i < res.length ; i++){
                var opt = document.createElement("option")
                opt.setAttribute("value" ,res[i])
                // console.log(res[i]);
//                 opt.innerHTML = res[i].split("userData\\")[1]
                // opt.innerHTML = "./" + res[i].split("userData/")[1];
                opt.innerHTML = res[i]
                sel.appendChild(opt)
            }

            var btn = document.createElement("button")
            btn.setAttribute("onclick" , "set_file_path()") 
            btn.setAttribute("class" , "btn btn-success")
            btn.setAttribute("id" , "selector_btn")
            btn.setAttribute("style" , "margin-left: 10px;")
            btn.innerHTML = "Select"
            _div.appendChild(btn);
            renderSelection();
            
        })
        .catch(error=>console.log('error' , error));


        // renderSelection();
    };
    function read_csv_data(){
        // Stores the file attached to a remote location and copies its URL, and then displays its content by calling a method
        var input = document.querySelector('input[type="file"]')
        var input_files_list = input.files
        if(input_files_list.length == 0){
            console.log("Please select a file")
            return null;
        }
        file = input_files_list[0]
        var formData = new FormData()
        formData.append('file_name', input_files_list[0])

        var requestOptions = {
          method:"POST",
          body: formData,
          redirect: 'follow',          
        };
        
        addLoader();
        
        fetch("/upload_data_for_clustering" , requestOptions)
        .then(response=>response.text())
        .then(result=>{
            removeLoader();
            result = JSON.parse(result)
            console.log(result)
            filepath = result['filepath']
            res_columns = result['columns']
            feature_selection_valid_columns();
            // step_selector()
        })
        .catch(error=>console.log('error' , error));

    }
    function set_file_path(){
        // sets filepath and fetches the columns in that file
        filepath = document.getElementById("file-selector").value;
        console.log("fpath " , filepath)
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
            // in API parameter the name should be same
            "filepath": filepath
        });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };
        addLoader();
        fetch('/api/v1/selected_file_columns_pyspark', requestOptions)
            .then(response => response.text())
            .then(result => {
                res = JSON.parse(result);
                console.log(res);
                res_columns = res['columns'];
                console.log(res_columns)
                feature_selection_valid_columns();
                // step_selector();
            })
            .catch(error => console.log('error', error));
    }
    function feature_selection_valid_columns(){
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
            // in API parameter the name should be same
            "filepath": filepath
        });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };
        fetch('/feature_selection_valid_columns_pyspark', requestOptions)
            .then(response => response.text())
            .then(result => {
                res = JSON.parse(result);
                console.log(res);
                numeric_columns = res['numeric_columns']
                categorical_columns = res["categorical_columns"]
                integer_columns = res["integer_columns"]
                console.log(res)
                step_selector();
                removeLoader();
            })
            .catch(error => console.log('error', error));
        
    }
    function step_selector(){
        // Fetches and displays the content of the input file
        var plot_container_ele = document.getElementById("plot_container")
        plot_container_ele.style.display = "none"

        var kbest_features_container_ele = document.getElementById("kbest_features_container")
        kbest_features_container_ele.style.display = "none"

        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        var raw = JSON.stringify({
            "filepath": filepath
        });
        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };
        // to get the content of df
        fetch("/data_values_pyspark", requestOptions)
            .then(response => response.json())
            .then(result => {
                df_res_before_processing = JSON.parse(result);
              
                generate_table_output(df_res_before_processing)
                fetch_target_columns()
                render_feature_selection()
            })
            .catch(error => console.log('error', error));
    }
    function remove_children_nodes(element_id){
        // Deletes all the child nodes from element with id:element_id
        var _element = document.getElementById(element_id)
        if(_element === null) return null;
        while(_element.hasChildNodes()) {
            _element.removeChild(_element.children[0])
        }
    }
    function generate_table_output(res){
        // creates a table from values present in "res" and displays it

        const columns = []
        for(var col in res[0]){
            columns.push(col)
        }
        console.log(columns)

        var table_container = document.getElementById("table_container")
    
        // removing the previous table values
        remove_children_nodes("df_before_processing_table")

        let mytable = document.getElementById('df_before_processing_table')
        let thead = document.createElement('thead');
        let tbody = document.createElement('tbody');
        mytable.appendChild(thead)
        mytable.appendChild(tbody)

        table_container.appendChild(mytable)

        var row_1 = document.createElement("tr")
        for(let i = 0 ; i < columns.length ; i++){
            let hdng = document.createElement("th")
            hdng.innerHTML = columns[i]
            row_1.appendChild(hdng)
        }
        // table headings
        thead.appendChild(row_1)

        for(let idx = 0 ; idx < res.length ; idx++){
            let trow = document.createElement('tr')
            for(var val in res[idx]){
                let trow_data = document.createElement('td')
                trow_data.innerHTML = (res[idx][val] === null) ? "null" : res[idx][val]
                trow.appendChild(trow_data)
            }
            tbody.appendChild(trow)            
        }    
    }
    function render_feature_selection(){

        var _div = document.getElementById("feature_selector")
        _div.style.display = "block"

        var filtering_selector_ele = document.getElementById("filtering-selector")
        filtering_selector_ele.innerHTML = ""
        
        var opt = document.createElement("option");
        opt.setAttribute("value", "");
        opt.setAttribute("disabled", "disabled");
        opt.setAttribute("selected", "selected");
        opt.innerHTML = "Select a Feature";
        filtering_selector_ele.appendChild(opt)
        
        // adding OPTIONS 
        var filtering_methods = ["Chi-Square" , "Variance Selector" , "One Way Anova" , "Correlation Coefficient"]
        
        for(var i = 0 ; i < filtering_methods.length ; i++){
            var opt = document.createElement("option")
            opt.setAttribute("value" , filtering_methods[i])
            opt.innerHTML = filtering_methods[i]
            filtering_selector_ele.appendChild(opt)
        }
        
        var k_val_ele = document.getElementById("k_val")
        k_val_ele.value = "" //resetting previous value
        k_val_ele.setAttribute("min" , 1)
        k_val_ele.setAttribute("max" , res_columns.length - 1)

        // adding button to perform filtering
        var filtering_btn_ele = document.getElementById("filtering_btn")        
        filtering_btn_ele.setAttribute("onclick" , "perform_filtering()")

        //by default loading chisquare target, on switching the options target options would change
        console.log("hhurhuvbruvbrubvrubvrubvurnv",target_candidates_chisquare)
        render_target_selection(target_candidates_chisquare)

        renderFeatureSelector()

        
        let fs_desc = document.getElementById("feature-selection-descriptions")
        fs_desc.style.display = "block";
    }
    document.getElementById('filtering-selector').onchange = function() {
        let value = document.getElementById("filtering-selector").value
        console.log("yo a change has been noticed" , value);
        if (value === "Chi-Square") render_target_selection(target_candidates_chisquare)
        else if (value === "Information gain") render_target_selection(target_candidates_infogain)
        else if (value === "Correlation Coefficient") render_target_selection(target_candidates_correlation)
        else if(value === "Fisher") render_target_selection(target_candidates_fisher)
        else{
            console.log("Name mistyped")
        }
    }
    function fetch_target_columns(){
        // Stores the possible target columns for particular filtering method: method
        console.log("fectching_target")
        target_candidates_chisquare = categorical_columns
        target_candidates_infogain = numeric_columns.concat(categorical_columns)
        target_candidates_correlation = numeric_columns
        target_candidates_fisher = categorical_columns

        function removeDuplicates(arr) {
            return [...new Set(arr)];
        }

        target_candidates_chisquare = removeDuplicates(target_candidates_chisquare)
        target_candidates_correlation = removeDuplicates(target_candidates_correlation)
        target_candidates_fisher = removeDuplicates(target_candidates_fisher)
        target_candidates_infogain = removeDuplicates(target_candidates_infogain)

        console.log(target_candidates_chisquare)
        console.log(target_candidates_correlation)
        console.log(target_candidates_fisher)
        console.log(target_candidates_infogain)
    }
    function render_target_selection(target_candidates){
        var target_selection_ele = document.getElementById("target-selector")
        target_selection_ele.innerHTML = "" // clearing previous target options
        console.log(target_candidates)
        var opt = document.createElement("option");
        opt.setAttribute("value", "");
        opt.setAttribute("disabled", "disabled");
        opt.setAttribute("selected", "selected");
        opt.innerHTML = "Select a Feature";
        target_selection_ele.appendChild(opt)
        
        for(var i = 0 ; i < target_candidates.length ; i++){
            var opt = document.createElement("option")
            opt.setAttribute("value" ,target_candidates[i])
            console.log(target_candidates[i]);
            opt.innerHTML = target_candidates[i]
            target_selection_ele.appendChild(opt)
        }
        if(target_selection_ele.innerHTML === ""){
            // No target element
            console.log("No target possible")
            var opt = document.createElement("option")
            opt.setAttribute("value" ,"NONE")
            opt.setAttribute("disabled" , "disabled")
            opt.innerHTML = "NONE"
            target_selection_ele.appendChild(opt)
        }
    }
    function start_loader(){
        let loader = document.getElementsByClassName("loader-element")
        if(loader == null) return;
        loader[0].style.display = "block"
        loader[1].style.display = "block"
    }
    function stop_loader(){
        let loader = document.getElementsByClassName("loader-element")
        if(loader == null) return;
        loader[0].style.display = "none"
        loader[1].style.display = "none"
    }
    function perform_filtering(){
        console.log("perform_filtering")

        // addLoaderPlot();
        
        // resetting the previous output after click
        var prev_plot_ele = document.getElementById("plot_div")
        prev_plot_ele.innerHTML = ""
        // prev_plot_ele.style.display = "block"
        // prev_plot_ele = "Loading..."
        var prev_kbest_ele = document.getElementById("kbest_features_container")
        prev_kbest_ele.style.display = "none"

        // clear ol inside kbest_features_container
        var prev_ol = document.getElementById("ol_kbest_features")
        if(prev_ol) prev_ol.remove()

        var prev_ol_analysis = document.getElementById("ol_analysis_features")
        if(prev_ol_analysis) prev_ol_analysis.remove()

        // start the loader
        // start_loader()
        var plot_ele = document.getElementById("plot_container")
        plot_ele.style.display = 'block'
        var kbest_ele = document.getElementById("kbest_features_container")
        kbest_ele.style.display = "block"

        var method_selected = document.getElementById("filtering-selector").value
        var k_selected = document.getElementById("k_val").value
        var target_selected = document.getElementById("target-selector").value

        console.log(target_selected) 
        console.log(method_selected)
        console.log(k_selected)
        console.log(filepath)

        if(method_selected === "" || k_selected === "" || target_selected === ""){
            console.log("Select valid values")
            return null;
        }

        addLoader();
        
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        var raw = JSON.stringify({
            // in API parameter the name should be same
            "method": method_selected,
            "filepath": filepath,
            "target": target_selected,
            "kval":k_selected,
            "categorical_columns":categorical_columns,
            "numeric_columns":numeric_columns
        });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };
        fetch("/feature_selection_pyspark" , requestOptions)
        // .then(response=>response.text())
        .then(response=>{
            if(response.ok) return response.text()
            else alert("Feature Selection Crashed")
        })
        .then(result => {
            removeLoader();
            result = JSON.parse(result)
            console.log(res_columns)

            // document.getElementsByClassName("loader").style.display = "none";
            
            if(method_selected == "Correlation Coefficient"){
                mat_val = result["corr_mat"]
                create_listused_in_analysis(numeric_columns)

                create_plot_corr_coeff(mat_val)
            }
            else{
                x_val = result["labels"]
                y_val = result["values"]
                console.log(x_val)
                console.log(y_val)
                const new_x_val = [
                    ...x_val,
                    target_selected,
                ];
                create_listused_in_analysis(new_x_val)

                create_plot(x_val , y_val)
            }

            create_kbest_list(result["best-features"])
        }).catch(error => {
            console.log('error', error),removeLoaderPlot()}
            );
    }
    function create_plot_corr_coeff(mat){
        updated_mat = mat
        console.log("res col" , res_columns)
        for(var i = 0 ; i < mat.length ; i++){
            updated_mat[i] = mat[i].map(function(each_element){
                return Number(each_element.toFixed(2));
            });
        }
        console.log("mat" , updated_mat)
        rev_numeric_columns = numeric_columns.slice().reverse() // reversing without mutating original
        var data = [
            {
                z: mat,
                x: numeric_columns, // x axis labels
                y: rev_numeric_columns, // y axis labels
                type: 'heatmap',
                hoverongaps: false
            }
        ];
        var layout = { 
                annotations: [],
                width: 650,
                height: 650,
                yaxis:{
                    automargin: true
                },
                xaxis:{
                    automargin: true
                }
        };
       
        let M = updated_mat.length

        for(var i = 0 ; i < M ; i++){
            for(var j = 0 ; j  < updated_mat[i].length ; j++){
                // if want to add different annotations, then we need to fetch the range of correlation coefficient values
                // if((updated_mat[i][j]  >= -0.6 && updated_mat[i][j] <= -0.2 ) || updated_mat[i][j] > 0.6){
                    // for changing the annotations color, for better readability
                var textColor = 'white'
                // }
                // else{
                //     var textColor = "black"
                // }
                var result = {
                    xref: 'x1',
                    yref: 'y1',
                    x: numeric_columns[j],
                    y: rev_numeric_columns[i],
                    text: updated_mat[i][j],
                    showarrow: false,
                    font: {
                        color: textColor
                    }
                };
                layout.annotations.push(result)
            }
        }
        console.log("layout" , layout.annotations)
        var plot_ele = document.getElementById("plot_container")
        plot_ele.style.display = 'block'
        Plotly.newPlot("plot_div" , data , layout , auto_open=false)
    }
    function create_plot(x_val , y_val){
        var plotData = [
                {
                    x : x_val,
                    y : y_val,
                    type: 'bar' 
                }
            ];
            var layout = {barmode: 'stack' , 
                width: 600,
                height: 600,
                yaxis:{
                    automargin: true
                },
                xaxis:{
                    automargin: true
                }
            };

            var plot_ele = document.getElementById("plot_container")
            plot_ele.style.display = 'block'
            Plotly.newPlot("plot_div" , plotData , layout , auto_open=false)

    }
    function save_plot_to_workspace(){
        console.log("save_plot_to_workspace")
        Plotly.toImage("plot_div",{
            filename:"graph",
            format:"png",
            height:600,
            width:600
        })
        .then(function(dataURL){
            var myHeaders = new Headers()
            myHeaders.append("Content-Type" , "application/json")
            var raw = JSON.stringify({
                "code" : dataURL
            })

            var requestOptions = {
                method:"POST",
                headers:myHeaders,
                body:raw,
                redirect:"follow"
            };

            fetch("save_graph" , requestOptions)
            .then(response=>{
                if (response.ok) {
                    alert("Image saved to the workspace")
                    return response.json()
                }
                else alert("Something wrong happended! Couldn't save image to the workspace") 
            })
            .catch(error => console.log(error))
        })
    }
    function create_listused_in_analysis(list_){
        var _div = document.getElementById("analysis_list_container")
        _div.style.display = "block"

        _div.innerHTML = "<h2>FEATURES USED FOR ANALYSIS</h2>"

        var prev_ol = document.getElementById("ol_analysis_features")
        if(prev_ol) prev_ol.remove()

        console.log(list_)

        var ordered_list = document.createElement("OL")
        ordered_list.setAttribute("class" , "list-group list-group-numbered")
        ordered_list.setAttribute("id" , "ol_analysis_features")
        ordered_list.setAttribute("style" , "list-style-position: inside; display:block;overflow-y: auto; height:300px; width: auto;")

        for(var i = 0 ; i < list_.length ; i++){
            var nlist = document.createElement("li")
            nlist.setAttribute("class","list-group-item")
            nlist.setAttribute("style" , "display:list-item;")
            nlist.innerHTML = list_[i]
            ordered_list.appendChild(nlist)
        }

        _div.appendChild(ordered_list)        
    }
    function create_kbest_list(kbest_features){
        var _div = document.getElementById("kbest_features_container")
        _div.style.display = "block"
        // _div.style = "display:block;overflow-y: scroll; height:150px; width: auto;"

        var prev_ol = document.getElementById("ol_kbest_features")
        if(prev_ol) prev_ol.remove()

        var ordered_list = document.createElement("OL")
        ordered_list.setAttribute("class" , "list-group list-group-numbered")
        ordered_list.setAttribute("id" , "ol_kbest_features")
        ordered_list.setAttribute("style" , "list-style-position: inside; display:block;overflow-y: auto; height:300px; width: auto;")

        for(var i = 0 ; i < kbest_features.length ; i++){
            var nlist = document.createElement("li")
            nlist.setAttribute("class","list-group-item")
            nlist.setAttribute("style" , "display:list-item;")
            nlist.innerHTML = kbest_features[i]
            ordered_list.appendChild(nlist)
        }

        _div.appendChild(ordered_list)

    }
</script>